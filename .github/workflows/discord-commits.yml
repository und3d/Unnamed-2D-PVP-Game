name: Notify Discord of Commit

on:
  push:
    branches:
      - '**'

jobs:
  discord:
    runs-on: ubuntu-latest
    steps:
      - name: Send Discord Notification
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
          COMMIT_MESSAGE: ${{ github.event.head_commit.message }}
          COMMIT_AUTHOR: ${{ github.event.head_commit.author.name }}
          COMMIT_URL: ${{ github.event.head_commit.url }}
          BRANCH_NAME: ${{ github.ref_name }}
        run: |
          PAYLOAD=$(jq -n \
            --arg username "GitHub Bot" \
            --arg title "New Commit to $BRANCH_NAME" \
            --arg description "$COMMIT_MESSAGE" \
            --arg author "$COMMIT_AUTHOR" \
            --arg branch "$BRANCH_NAME" \
            --arg url "$COMMIT_URL" \
            '{
              username: $username,
              embeds: [
                {
                  title: $title,
                  description: $description,
                  color: 5814783,
                  fields: [
                    { name: "Author", value: $author, inline: true },
                    { name: "Branch", value: $branch, inline: true }
                  ],
                  url: $url
                }
              ]
            }'
          )
        
          curl -H "Content-Type: application/json" \
               -X POST \
               -d "$PAYLOAD" \
               "$DISCORD_WEBHOOK"
